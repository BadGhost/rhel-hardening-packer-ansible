# RHEL 9 Kickstart configuration
# System language
lang en_US.UTF-8

# Keyboard layouts
keyboard us

# Enable network
network --bootproto=dhcp --device=link --activate

# Root password
rootpw --plaintext <your_secure_password>

# System timezone
timezone America/New_York --utc

# Use text mode install
text

# Use CDROM installation media
cdrom

# System bootloader configuration
bootloader --location=mbr --append="crashkernel=auto rhgb quiet"

# Clear the Master Boot Record
zerombr

# Partition clearing information
clearpart --all --initlabel

# Disk partitioning information
part /boot --fstype="xfs" --size=1024
part /boot/efi --fstype="efi" --size=600 --fsoptions="umask=0077,shortname=winnt"
part pv.01 --grow --size=1

# Volume group
volgroup rhel --pesize=4096 pv.01

# Logical volumes
logvol / --fstype="xfs" --size=10240 --name=root --vgname=rhel
logvol /var --fstype="xfs" --size=4096 --name=var --vgname=rhel
logvol /var/log --fstype="xfs" --size=4096 --name=var_log --vgname=rhel
logvol /var/log/audit --fstype="xfs" --size=2048 --name=var_log_audit --vgname=rhel
logvol /home --fstype="xfs" --size=4096 --name=home --vgname=rhel
logvol swap --fstype="swap" --size=2048 --name=swap --vgname=rhel
logvol /tmp --fstype="xfs" --size=2048 --name=tmp --vgname=rhel --fsoptions="nodev,nosuid,noexec"

# System authorization information
auth --enableshadow --passalgo=sha512

# SELinux configuration
selinux --enforcing

# Firewall configuration
firewall --enabled --ssh

# Do not configure the X Window System
skipx

# Reboot after installation
reboot

# Packages
%packages
@core
sudo
openssh-server
openssh-clients
%end

# Post-installation script
%post
# Create a user with sudo privileges
useradd ansible
echo "<your_secure_password>" | passwd --stdin ansible
echo "ansible ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/ansible
chmod 0440 /etc/sudoers.d/ansible

# Ensure SSH is enabled and running
systemctl enable sshd
systemctl start sshd
%end